#INFO: **** input file is /lustre/home/1600011363/neci-work/embedding_code_release/1_pm/1a_PM.py ****
#!/usr/bin/env python3

import numpy as np
from pyscf import gto, scf  # , mcscf, fci
from pyscf.qmmm import mm_charge
# from pyscf import lo
from pyscf.tools import molden
# from pyscf.lib import logger
# from pyscf import symm
import os
import sys
from pyscf.lib import logger
from pyscf.lo import orth
from pyscf.lo import PM
from pyscf.pbc.scf.addons import smearing_

from functools import reduce

# assign project to the filename without .py
pyfile = __file__
project = pyfile[:pyfile.rfind(".")]

mol = gto.Mole()
mol.max_memory = 110*1024
mol.verbose = 4
mol.output = project+".log"
mol.build(
    atom="""
O1     -0.000000000     0.000000000     0.092050000
Cu1     0.006363961     1.904945669     0.000000000
Cu1    -0.006363961    -1.904945669     0.000000000
La1     1.878187334    -0.020394374    -1.814700000
La1    -1.878187334     0.020394374    -1.814700000
La1     1.931704003     0.033122296     1.814700000
La1    -1.931704003    -0.033122296     1.814700000
O2      1.898581707    -1.898581707     0.092050000
O2     -1.898581707     1.898581707     0.092050000
O2      1.911309630     1.911309630    -0.092050000
O2     -1.911309630    -1.911309630    -0.092050000
O2      0.112137236    -1.786444471    -2.459050000
O2     -0.112137236     1.786444471    -2.459050000
O2     -0.124865158    -2.023446866     2.459050000
O2      0.124865158     2.023446866     2.459050000
O2      3.809891337     0.012727922    -0.092050000
O2      0.012727922     3.809891337    -0.092050000
O2     -3.809891337    -0.012727922    -0.092050000
O2     -0.012727922    -3.809891337    -0.092050000
Cu2    -3.803527376     1.892217746     0.000000000
Cu2     3.803527376    -1.892217746     0.000000000
Cu2    -3.816255298    -1.917673591     0.000000000
Cu2     3.816255298     1.917673591     0.000000000
La2     1.890915256     3.789496963     1.814700000
La2    -1.890915256    -3.789496963     1.814700000
La2    -1.918976081     3.776769041    -1.814700000
La2     1.918976081    -3.776769041    -1.814700000
La2     1.865459412    -3.830285711     1.814700000
La2    -1.865459412     3.830285711     1.814700000
La2    -1.944431925    -3.843013633    -1.814700000
La2     1.944431925     3.843013633    -1.814700000
La2     0.020394374    -1.878187334     4.760300000
La2    -0.020394374     1.878187334     4.760300000
La2     0.033122296     1.931704003    -4.760300000
La2    -0.033122296    -1.931704003    -4.760300000
O3      3.797163415    -3.797163415     0.092050000
O3     -3.797163415     3.797163415     0.092050000
O3      3.822619259     3.822619259     0.092050000
O3     -3.822619259    -3.822619259     0.092050000
Cu2     0.019091883     5.714837006     0.000000000
Cu2    -0.019091883    -5.714837006     0.000000000
O3      1.885853785    -5.708473045    -0.092050000
O3     -1.885853785     5.708473045    -0.092050000
O3      5.708473045    -1.885853785    -0.092050000
O3     -5.708473045     1.885853785    -0.092050000
O3     -5.721200967    -1.924037552     0.092050000
O3     -1.924037552    -5.721200967     0.092050000
O3      1.924037552     5.721200967     0.092050000
O3      5.721200967     1.924037552     0.092050000
O3      0.025455844     7.619782674     0.092050000
O3     -0.025455844    -7.619782674     0.092050000
""",
    ecp={"Cu2": "crenbs",
         "La": gto.basis.parse_ecp("""
La nelec 46
La ul
2      1.000000000            0.0000000
La S
2      3.30990000            91.9321770
2      1.65500000            -3.7887640
La P
2      2.83680000            63.7594860
2      1.41840000            -0.6479580
La D
2      2.02130000            36.1191730
2      1.01070000             0.2191140
La F
2      4.02860000           -36.0100160
           """),
         "La2": "crenbs"
         },
    basis={"Cu1": "ccpvdz",
           "Cu2": "crenbs",
           "O1": "ccpvdz",
           "O2": "ccpvdz",
           "O3": "ccpvdz@3s2p",
           "La1":  gto.parse("""
#BASIS SET: (4s4p3d) -> [2s2p1d] Basis  for PP46MWB
La   S
      5.087399            -0.417243             0.000000
      4.270978             0.886010             0.000000
      1.915458            -1.419752             0.000000
      0.525596             0.000000             1.000000
La   P
      3.025161             0.538196             0.000000
      2.382095            -0.981640             0.000000
      0.584426             1.239590             0.000000
      0.260360             0.000000             1.000000
La   D
      1.576824            -0.096944
      0.592390             0.407466
      0.249500             0.704363
END
"""),
           "La2": "crenbs"
           },
    # symmetry=False,
    symmetry=True,
    # symmetry="D2h",
    charge=10,
)

chg_fname = "../0_hf/La214_Grande.evjen.lat"
chg_data = np.loadtxt(chg_fname, skiprows=2)
coords = chg_data[:, 0:3]
assert (coords == np.loadtxt(chg_fname, skiprows=2)[:, 0:3]).all()
charges = chg_data[:, 3]

def dump_flags(qmmm_obj, verbose=None):
    method_class = qmmm_obj.__class__.__bases__[1]
    method_class.dump_flags(qmmm_obj, verbose)
    logger.info(qmmm_obj, "** Add background charges for %s", method_class)
    if qmmm_obj.verbose >= logger.DEBUG:
        logger.debug(qmmm_obj, 'Charge      Location')
        coords = qmmm_obj.mm_mol.atom_coords()
        charges = qmmm_obj.mm_mol.atom_charges()
        if len(charges) <= 12:
            for i, z in enumerate(charges):
                logger.debug(qmmm_obj, '%.9g    %s', z, coords[i])
        else:
            for i, z in enumerate(charges[:6]):
                logger.debug(qmmm_obj, '%.9g    %s', z, coords[i])
            logger.debug(qmmm_obj, '...... (%i point charges in total)', len(charges))
            for i, z in enumerate(charges[-6:]):
                logger.debug(qmmm_obj, '%.9g    %s', z, coords[i])
    return qmmm_obj

mf = mm_charge(scf.RHF(mol), coords, charges)
mf.dump_flags = lambda *args, **kwargs: dump_flags(mf, *args, **kwargs)
restart_chk = "../0_hf/0b_mixedrhf-rhf_mixed1.chk"
mo_coeff = scf.chkfile.load(restart_chk, "scf/mo_coeff")
mo_energy = scf.chkfile.load(restart_chk, "scf/mo_energy")
mo_occ = scf.chkfile.load(restart_chk, "scf/mo_occ")
# print(mo_occ==2)

double_occ = mo_coeff[:,mo_occ==2]
single_occ = mo_coeff[:,mo_occ==1]
empty_occ = mo_coeff[:,mo_occ==0]

double_loc = PM(mol, double_occ).kernel()
single_loc = PM(mol, single_occ).kernel()
empty_loc = PM(mol, empty_occ).kernel()

def atom_belong(mol, *mos):
    r_ao = mol.intor_symmetric("int1e_r", comp=3)
    atom_list, atom_pos = tuple(map(np.array, zip(*mol._atom)))
    result = list()
    for i, mo in enumerate(mos):
        r_mean = np.einsum("ui,xuv,vi->ix", mo, r_ao, mo)
        orb_rela_pos = np.linalg.norm(r_mean[:,None,:] - atom_pos, axis=2)
        atom_closest = np.argmin(orb_rela_pos, axis=1)
        print(atom_closest)
        result.append(atom_closest)
    return tuple(result)

atom_list, atom_pos = tuple(map(np.array, zip(*mol._atom)))
d_at, s_at, u_at = atom_belong(mol, double_loc, single_loc, empty_loc)
for i, atm_name in enumerate(atom_list):
    print("Atom #%i, Label %s, Occurence in d %i, s %i, u %i" % 
            (i, atm_name, np.count_nonzero(d_at == i), np.count_nonzero(s_at == i), np.count_nonzero(u_at == i)))
    
atomlist_a = np.array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 18], dtype=int) # Cu 2 O 11 La 4
atomlist_b = np.setdiff1d(np.arange(mol.natm), atomlist_a)
atomlist_b2 = np.array([35, 36, 37, 38, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50], dtype=int)
atomlist_b1 = np.setdiff1d(atomlist_b, atomlist_b2)
double_loc_a = double_loc[:,np.in1d(d_at, atomlist_a)]
double_loc_b = double_loc[:,np.in1d(d_at, atomlist_b)]
single_loc_a = single_loc[:,np.in1d(s_at, atomlist_a)]
single_loc_b = single_loc[:,np.in1d(s_at, atomlist_b)]
# Get the original PM localized orbital. 

# I found a bug in my old localization script.

# If we work in a Cu 2 O 11 La 4 cluster, then the cluster atom list (A atom) should be

# np.array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 18]).

# However, in my old code, A atom is incorrectly written as

# np.array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 18]).

# This leads to a wrong cluster setting, potentially making all the following calculations wrong and SCF and CASSCF convergence extremely hard.

dma = 2 * np.einsum("vi,ui->uv", *((double_loc_a,)*2)) \
        + np.einsum("vi,ui->uv", *((single_loc_a,)*2))
dmb = 2 * np.einsum("vi,ui->uv", *((double_loc_b,)*2)) \
        + np.einsum("vi,ui->uv", *((single_loc_b,)*2))
empty_loc_ab1 = empty_loc[:,np.in1d(u_at, np.concatenate((atomlist_a, atomlist_b1)))]
empty_loc_b2  = empty_loc[:,np.in1d(u_at, atomlist_b2)]

from pyscf.lib.chkfile import save
save(project + ".chk", "mo_da", double_loc_a)
save(project + ".chk", "mo_db", double_loc_b)
save(project + ".chk", "mo_sa", single_loc_a)
save(project + ".chk", "mo_sb", single_loc_b)
save(project + ".chk", "mo_u",  empty_loc)
save(project + ".chk", "mo_uab1",  empty_loc_ab1)
save(project + ".chk", "mo_ub2", empty_loc_b2)
save(project + ".chk", "dm_a",  dma)
save(project + ".chk", "dm_b",  dmb)

molden.from_mo(mol, project+"_double_occ_A.molden", double_loc_a, occ=2*np.ones(double_loc_a.shape[1]), symm=None)
molden.from_mo(mol, project+"_double_occ_B.molden", double_loc_b, occ=2*np.ones(double_loc_b.shape[1]))
molden.from_mo(mol, project+"_single_occ_A.molden", single_loc_a, occ=  np.ones(single_loc_a.shape[1]))
molden.from_mo(mol, project+"_single_occ_B.molden", single_loc_b, occ=  np.ones(single_loc_b.shape[1]))
molden.from_mo(mol, project+"_empty_occ.molden",    empty_loc,    occ=  np.ones(empty_loc.shape[1]))
molden.from_mo(mol, project+"_empty_occ_AB1.molden",empty_loc_ab1,occ=  np.zeros(empty_loc_ab1.shape[1]))
molden.from_mo(mol, project+"_empty_occ_B2.molden", empty_loc_b2, occ=  np.zeros(empty_loc_b2.shape[1]))

import sys
sys.path.append("..")
from orth_csv import save_csv, c_meta_lowdin_ao

def write_mulliken(mol, mo, outfile_mark="", s=None, label_mark=None):
    if s is None:
        s = mol.intor_symmetric("int1e_ovlp")
    orth_coeff = orth.orth_ao(mol, "meta_lowdin", s=s)

    label = mol.ao_labels()
    save_csv(project + "%s_meta_lowdin_orth.csv" % outfile_mark, orth_coeff, label_row=label, label_col=label)
    _, mo_orth = c_meta_lowdin_ao(mol, mo, s=s, orth_coeff=orth_coeff)

    if label_mark is None:
        label2_withmark = label
    else:
        label2_withmark = ["#%i %s" % (i, mk) for i, mk in zip(range(mo.shape[1]), label_mark)]
    save_csv(project + "%s_mo_in_meta_lowdin.csv" % outfile_mark, mo_orth, label_row=label, label_col=label2_withmark)

label_mark = ["da#%i" % i for i in range(double_loc_a.shape[1])] \
           + ["sa#%i" % i for i in range(single_loc_a.shape[1])] \
           + ["uab1#%i" % i for i in range(empty_loc_ab1.shape[1])] \
           + ["ub2#%i" % i for i in range(empty_loc_b2.shape[1])] \
           + ["sb#%i" % i for i in range(single_loc_b.shape[1])] \
           + ["db#%i" % i for i in range(double_loc_b.shape[1])]
for i in range(len(label_mark)):
    label_mark[i] = ("#%i_" % i) + label_mark[i]

write_mulliken(mol, np.hstack((double_loc_a, single_loc_a, empty_loc_ab1, empty_loc_b2, single_loc_b, double_loc_b)),
                    outfile_mark = "local",
                    label_mark = label_mark)
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='l08c52n2', release='4.18.0-425.3.1.el8.x86_64', version='#1 SMP Wed Nov 9 20:13:27 UTC 2022', machine='x86_64')  Threads 32
Python 3.9.18 (main, Sep 11 2023, 13:41:44) 
[GCC 11.2.0]
numpy 1.24.4  scipy 1.9.0
Date: Fri Jun  7 22:49:13 2024
PySCF version 2.1.0
PySCF path  /lustre/home/1600011363/anaconda3/envs/python_old/lib/python3.9/site-packages/pyscf

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 51
[INPUT] num. electrons = 410
[INPUT] charge = 10
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry True subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 O1     0.000000000000   0.000000000000   0.092050000000 AA    0.000000000000   0.000000000000   0.173949289766 Bohr   0.0
[INPUT]  2 Cu1    0.006363961000   1.904945669000   0.000000000000 AA    0.012026143357   3.599825596586   0.000000000000 Bohr   0.0
[INPUT]  3 Cu1   -0.006363961000  -1.904945669000   0.000000000000 AA   -0.012026143357  -3.599825596586   0.000000000000 Bohr   0.0
[INPUT]  4 La1    1.878187334000  -0.020394374000  -1.814700000000 AA    3.549259671887  -0.038539781342  -3.429285998248 Bohr   0.0
[INPUT]  5 La1   -1.878187334000   0.020394374000  -1.814700000000 AA   -3.549259671887   0.038539781342  -3.429285998248 Bohr   0.0
[INPUT]  6 La1    1.931704003000   0.033122296000   1.814700000000 AA    3.650391519396   0.062592068057   3.429285998248 Bohr   0.0
[INPUT]  7 La1   -1.931704003000  -0.033122296000   1.814700000000 AA   -3.650391519396  -0.062592068057   3.429285998248 Bohr   0.0
[INPUT]  8 O2     1.898581707000  -1.898581707000   0.092050000000 AA    3.587799451339  -3.587799451339   0.173949289766 Bohr   0.0
[INPUT]  9 O2    -1.898581707000   1.898581707000   0.092050000000 AA   -3.587799451339   3.587799451339   0.173949289766 Bohr   0.0
[INPUT] 10 O2     1.911309630000   1.911309630000  -0.092050000000 AA    3.611851739944   3.611851739944  -0.173949289766 Bohr   0.0
[INPUT] 11 O2    -1.911309630000  -1.911309630000  -0.092050000000 AA   -3.611851739944  -3.611851739944  -0.173949289766 Bohr   0.0
[INPUT] 12 O2     0.112137236000  -1.786444471000  -2.459050000000 AA    0.211908664406  -3.375890786934  -4.646931026612 Bohr   0.0
[INPUT] 13 O2    -0.112137236000   1.786444471000  -2.459050000000 AA   -0.211908664406   3.375890786934  -4.646931026612 Bohr   0.0
[INPUT] 14 O2    -0.124865158000  -2.023446866000   2.459050000000 AA   -0.235960951121  -3.823760404350   4.646931026612 Bohr   0.0
[INPUT] 15 O2     0.124865158000   2.023446866000   2.459050000000 AA    0.235960951121   3.823760404350   4.646931026612 Bohr   0.0
[INPUT] 16 O2     3.809891337000   0.012727922000  -0.092050000000 AA    7.199651191283   0.024052286715  -0.173949289766 Bohr   0.0
[INPUT] 17 O2     0.012727922000   3.809891337000  -0.092050000000 AA    0.024052286715   7.199651191283  -0.173949289766 Bohr   0.0
[INPUT] 18 O2    -3.809891337000  -0.012727922000  -0.092050000000 AA   -7.199651191283  -0.024052286715  -0.173949289766 Bohr   0.0
[INPUT] 19 O2    -0.012727922000  -3.809891337000  -0.092050000000 AA   -0.024052286715  -7.199651191283  -0.173949289766 Bohr   0.0
[INPUT] 20 Cu2   -3.803527376000   1.892217746000   0.000000000000 AA   -7.187625047926   3.575773307982   0.000000000000 Bohr   0.0
[INPUT] 21 Cu2    3.803527376000  -1.892217746000   0.000000000000 AA    7.187625047926  -3.575773307982   0.000000000000 Bohr   0.0
[INPUT] 22 Cu2   -3.816255298000  -1.917673591000   0.000000000000 AA   -7.211677334640  -3.623877883301   0.000000000000 Bohr   0.0
[INPUT] 23 Cu2    3.816255298000   1.917673591000   0.000000000000 AA    7.211677334640   3.623877883301   0.000000000000 Bohr   0.0
[INPUT] 24 La2    1.890915256000   3.789496963000   1.814700000000 AA    3.573311958602   7.161111409941   3.429285998248 Bohr   0.0
[INPUT] 25 La2   -1.890915256000  -3.789496963000   1.814700000000 AA   -3.573311958602  -7.161111409941   3.429285998248 Bohr   0.0
[INPUT] 26 La2   -1.918976081000   3.776769041000  -1.814700000000 AA   -3.626339232681   7.137059123226  -3.429285998248 Bohr   0.0
[INPUT] 27 La2    1.918976081000  -3.776769041000  -1.814700000000 AA    3.626339232681  -7.137059123226  -3.429285998248 Bohr   0.0
[INPUT] 28 La2    1.865459412000  -3.830285711000   1.814700000000 AA    3.525207385172  -7.238190972625   3.429285998248 Bohr   0.0
[INPUT] 29 La2   -1.865459412000   3.830285711000   1.814700000000 AA   -3.525207385172   7.238190972625   3.429285998248 Bohr   0.0
[INPUT] 30 La2   -1.944431925000  -3.843013633000  -1.814700000000 AA   -3.674443806111  -7.262243259340  -3.429285998248 Bohr   0.0
[INPUT] 31 La2    1.944431925000   3.843013633000  -1.814700000000 AA    3.674443806111   7.262243259340  -3.429285998248 Bohr   0.0
[INPUT] 32 La2    0.020394374000  -1.878187334000   4.760300000000 AA    0.038539781342  -3.549259671887   8.995663270767 Bohr   0.0
[INPUT] 33 La2   -0.020394374000   1.878187334000   4.760300000000 AA   -0.038539781342   3.549259671887   8.995663270767 Bohr   0.0
[INPUT] 34 La2    0.033122296000   1.931704003000  -4.760300000000 AA    0.062592068057   3.650391519396  -8.995663270767 Bohr   0.0
[INPUT] 35 La2   -0.033122296000  -1.931704003000  -4.760300000000 AA   -0.062592068057  -3.650391519396  -8.995663270767 Bohr   0.0
[INPUT] 36 O3     3.797163415000  -3.797163415000   0.092050000000 AA    7.175598904568  -7.175598904568   0.173949289766 Bohr   0.0
[INPUT] 37 O3    -3.797163415000   3.797163415000   0.092050000000 AA   -7.175598904568   7.175598904568   0.173949289766 Bohr   0.0
[INPUT] 38 O3     3.822619259000   3.822619259000   0.092050000000 AA    7.223703477998   7.223703477998   0.173949289766 Bohr   0.0
[INPUT] 39 O3    -3.822619259000  -3.822619259000   0.092050000000 AA   -7.223703477998  -7.223703477998   0.173949289766 Bohr   0.0
[INPUT] 40 Cu2    0.019091883000   5.714837006000   0.000000000000 AA    0.036078430072  10.799476787869   0.000000000000 Bohr   0.0
[INPUT] 41 Cu2   -0.019091883000  -5.714837006000   0.000000000000 AA   -0.036078430072 -10.799476787869   0.000000000000 Bohr   0.0
[INPUT] 42 O3     1.885853785000  -5.708473045000  -0.092050000000 AA    3.563747164624 -10.787450644512  -0.173949289766 Bohr   0.0
[INPUT] 43 O3    -1.885853785000   5.708473045000  -0.092050000000 AA   -3.563747164624  10.787450644512  -0.173949289766 Bohr   0.0
[INPUT] 44 O3     5.708473045000  -1.885853785000  -0.092050000000 AA   10.787450644512  -3.563747164624  -0.173949289766 Bohr   0.0
[INPUT] 45 O3    -5.708473045000   1.885853785000  -0.092050000000 AA  -10.787450644512   3.563747164624  -0.173949289766 Bohr   0.0
[INPUT] 46 O3    -5.721200967000  -1.924037552000   0.092050000000 AA  -10.811502931227  -3.635904026659   0.173949289766 Bohr   0.0
[INPUT] 47 O3    -1.924037552000  -5.721200967000   0.092050000000 AA   -3.635904026659 -10.811502931227   0.173949289766 Bohr   0.0
[INPUT] 48 O3     1.924037552000   5.721200967000   0.092050000000 AA    3.635904026659  10.811502931227   0.173949289766 Bohr   0.0
[INPUT] 49 O3     5.721200967000   1.924037552000   0.092050000000 AA   10.811502931227   3.635904026659   0.173949289766 Bohr   0.0
[INPUT] 50 O3     0.025455844000   7.619782674000   0.092050000000 AA    0.048104573430  14.399302382566   0.173949289766 Bohr   0.0
[INPUT] 51 O3    -0.025455844000  -7.619782674000   0.092050000000 AA   -0.048104573430 -14.399302382566   0.173949289766 Bohr   0.0

nuclear repulsion = 9564.87656255217
point group symmetry = C2
symmetry origin: [-3.42758732e-17  0.00000000e+00  1.59582269e-02]
symmetry axis x: [ 9.99919252e-01 -1.27078161e-02 -1.17064196e-19]
symmetry axis y: [-1.27078161e-02 -9.99919252e-01 -9.21123989e-18]
symmetry axis z: [ 0.00000000e+00 -9.21198374e-18  1.00000000e+00]
num. orbitals of irrep A = 296
num. orbitals of irrep B = 294
number of shells = 195
number of NR pGTOs = 1558
number of NR cGTOs = 590
basis = {'Cu1': 'ccpvdz', 'Cu2': 'crenbs', 'O1': 'ccpvdz', 'O2': 'ccpvdz', 'O3': 'ccpvdz@3s2p', 'La1': [[0, [5.087399, -0.417243, 0.0], [4.270978, 0.88601, 0.0], [1.915458, -1.419752, 0.0], [0.525596, 0.0, 1.0]], [1, [3.025161, 0.538196, 0.0], [2.382095, -0.98164, 0.0], [0.584426, 1.23959, 0.0], [0.26036, 0.0, 1.0]], [2, [1.576824, -0.096944], [0.59239, 0.407466], [0.2495, 0.704363]]], 'La2': 'crenbs'}
ecp = {'Cu2': 'crenbs', 'La': [46, [[-1, [[], [], [[1.0, 0.0]], [], [], [], []]], [0, [[], [], [[3.3099, 91.932177], [1.655, -3.788764]], [], [], [], []]], [1, [[], [], [[2.8368, 63.759486], [1.4184, -0.647958]], [], [], [], []]], [2, [[], [], [[2.0213, 36.119173], [1.0107, 0.219114]], [], [], [], []]], [3, [[], [], [[4.0286, -36.010016]], [], [], [], []]]]], 'La2': 'crenbs'}
CPU time:         3.80


******** <class 'pyscf.lo.pipek.PipekMezey'> ********
conv_tol = 1e-06
conv_tol_grad = None
max_cycle = 100
max_stepsize = 0.05
max_iters = 20
kf_interval = 5
kf_trust_region = 5
ah_start_tol = 1000000000.0
ah_start_cycle = 1
ah_level_shift = 0
ah_conv_tol = 1e-12
ah_lindep = 1e-14
ah_max_cycle = 40
ah_trust_region = 3
init_guess = atomic
pop_method = meta_lowdin
Set conv_tol_grad to 0.000316228
macro= 1  f(x)= 179.91878410241  delta_f= 179.919  |g|= 0.0823487  5 KF 25 Hx
macro= 2  f(x)= 180.00177170645  delta_f= 0.0829876  |g|= 0.0139485  5 KF 28 Hx
macro= 3  f(x)= 180.01347754773  delta_f= 0.0117058  |g|= 0.00932838  5 KF 29 Hx
macro= 4  f(x)= 180.01583483316  delta_f= 0.00235729  |g|= 0.00230407  6 KF 32 Hx
macro= 5  f(x)= 180.0159930808  delta_f= 0.000158248  |g|= 0.000557207  3 KF 16 Hx
macro= 6  f(x)= 180.01670597846  delta_f= 0.000712898  |g|= 0.00674665  5 KF 29 Hx
macro= 7  f(x)= 180.0168210707  delta_f= 0.000115092  |g|= 0.000427539  6 KF 35 Hx
macro= 8  f(x)= 180.0168240084  delta_f= 2.9377e-06  |g|= 0.000141314  1 KF 1 Hx
macro= 9  f(x)= 180.01682406612  delta_f= 5.77198e-08  |g|= 3.05391e-05  1 KF 1 Hx
macro X = 9  f(x)= 180.01682406612  |g|= 3.05391e-05  18 intor 37 KF 196 Hx


******** <class 'pyscf.lo.pipek.PipekMezey'> ********
conv_tol = 1e-06
conv_tol_grad = None
max_cycle = 100
max_stepsize = 0.05
max_iters = 20
kf_interval = 5
kf_trust_region = 5
ah_start_tol = 1000000000.0
ah_start_cycle = 1
ah_level_shift = 0
ah_conv_tol = 1e-12
ah_lindep = 1e-14
ah_max_cycle = 40
ah_trust_region = 3
init_guess = atomic
pop_method = meta_lowdin
Set conv_tol_grad to 0.000316228
macro= 1  f(x)= 2.7176790055551  delta_f= 2.71768  |g|= 0.0158503  1 KF 2 Hx
macro= 2  f(x)= 2.7176790055552  delta_f= 9.54792e-14  |g|= 7.75675e-06  1 KF 1 Hx
macro X = 2  f(x)= 2.7176790055552  |g|= 7.75675e-06  4 intor 2 KF 3 Hx


******** <class 'pyscf.lo.pipek.PipekMezey'> ********
conv_tol = 1e-06
conv_tol_grad = None
max_cycle = 100
max_stepsize = 0.05
max_iters = 20
kf_interval = 5
kf_trust_region = 5
ah_start_tol = 1000000000.0
ah_start_cycle = 1
ah_level_shift = 0
ah_conv_tol = 1e-12
ah_lindep = 1e-14
ah_max_cycle = 40
ah_trust_region = 3
init_guess = atomic
pop_method = meta_lowdin
Set conv_tol_grad to 0.000316228
macro= 1  f(x)= 365.89087059304  delta_f= 365.891  |g|= 0.0533363  5 KF 25 Hx
macro= 2  f(x)= 365.92236417849  delta_f= 0.0314936  |g|= 0.0105315  5 KF 29 Hx
macro= 3  f(x)= 365.9331785387  delta_f= 0.0108144  |g|= 0.00673956  5 KF 29 Hx
macro= 4  f(x)= 365.94137114992  delta_f= 0.00819261  |g|= 0.00585864  5 KF 30 Hx
macro= 5  f(x)= 365.94696585733  delta_f= 0.00559471  |g|= 0.00278801  6 KF 31 Hx
macro= 6  f(x)= 365.94837868069  delta_f= 0.00141282  |g|= 0.000382733  6 KF 35 Hx
macro= 7  f(x)= 365.94865800972  delta_f= 0.000279329  |g|= 0.000217741  6 KF 36 Hx
macro= 8  f(x)= 365.94878910109  delta_f= 0.000131091  |g|= 0.00033967  6 KF 35 Hx
macro= 9  f(x)= 365.94879953722  delta_f= 1.04361e-05  |g|= 4.73551e-05  5 KF 25 Hx
macro= 10  f(x)= 365.94880390276  delta_f= 4.36553e-06  |g|= 5.02608e-05  1 KF 1 Hx
macro= 11  f(x)= 365.94880896686  delta_f= 5.0641e-06  |g|= 5.20865e-05  1 KF 1 Hx
macro= 12  f(x)= 365.94881384008  delta_f= 4.87321e-06  |g|= 5.00195e-05  1 KF 1 Hx
macro= 13  f(x)= 365.94881733669  delta_f= 3.49662e-06  |g|= 4.73803e-05  1 KF 1 Hx
macro= 14  f(x)= 365.94882726699  delta_f= 9.9303e-06  |g|= 5.49488e-05  1 KF 5 Hx
macro= 15  f(x)= 365.94882996513  delta_f= 2.69815e-06  |g|= 6.57649e-05  1 KF 1 Hx
macro= 16  f(x)= 365.94883264186  delta_f= 2.67673e-06  |g|= 6.04502e-05  1 KF 1 Hx
macro= 17  f(x)= 365.94883526474  delta_f= 2.62288e-06  |g|= 5.61519e-05  1 KF 1 Hx
macro= 18  f(x)= 365.94883780003  delta_f= 2.53529e-06  |g|= 5.3528e-05  1 KF 1 Hx
macro= 19  f(x)= 365.94884021369  delta_f= 2.41365e-06  |g|= 5.33529e-05  1 KF 1 Hx
macro= 20  f(x)= 365.94884247241  delta_f= 2.25873e-06  |g|= 5.62274e-05  1 KF 1 Hx
macro= 21  f(x)= 365.94884938493  delta_f= 6.91251e-06  |g|= 6.22929e-05  1 KF 6 Hx
macro= 22  f(x)= 365.94885028707  delta_f= 9.02147e-07  |g|= 5.99589e-05  1 KF 1 Hx
macro X = 22  f(x)= 365.94885028707  |g|= 5.99589e-05  44 intor 62 KF 297 Hx

WARN: orbitals [ 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 17 18 19 20 21 22 23 24
 25 26 27 28 29 30 31 32 34 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50
 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 72 74 75 76
 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96] not symmetrized, norm = [0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.50000001
 0.50000001 0.5        0.5        0.50000002 0.50000002 0.5
 0.5        0.5       ]


WARN: orbitals [  0   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17
  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32  33  34  35
  36  37  38  39  40  41  42  43  44  45  46  47  48  49  50  51  52  53
  54  55  56  57  58  59  60  61  62  63  64  65  66  67  68  69  70  71
  72  73  74  75  76  77  78  79  80  81  82  83  84  85  86  87  88  89
  90  91  92  93  94  95  96  97  98  99 100 101 102 103] not symmetrized, norm = [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]


WARN: orbitals [0 1] not symmetrized, norm = [0.5 0.5]


WARN: orbitals [0 1 2 3 4 5] not symmetrized, norm = [0.5 0.5 0.5 0.5 0.5 0.5]


WARN: orbitals [  0   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17
  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32  33  34  35
  36  37  38  39  40  41  42  43  44  45  46  47  48  49  50  51  52  53
  54  55  56  57  58  59  60  61  62  63  64  65  66  67  68  69  70  71
  72  73  74  75  76  77  78  79  80  81  82  83  84  85  86  87  88  89
  90  91  92  93  94  95  96  97  98  99 100 101 102 103 104 105 106 107
 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125
 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143
 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161
 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179
 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197
 198 199 200 201 203 204 205 207 208 209 210 211 212 213 214 215 216 217
 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235
 236 237 238 239 240 241 242 243 244 245 247 248 249 251 252 253 254 255
 256 258 259 260 261 262 263 264 266 267 268 269 270 272 273 274 276 277
 278 279 280 281 282 284 285 286 287 288 289 290 291 292 293 294 295 296
 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314
 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332
 333 334 335 336 337 338 339 340 341 342 343 344 345 346 347 348 349 350
 351 352 353 354 355 356 357 358 359 360 361 362 363 364 365 366 367 368
 369 370 371 372 373 374 375 376 377 378 379 380] not symmetrized, norm = [0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.50000001 0.5        0.5        0.5
 0.5        0.50000001 0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5       ]


WARN: orbitals [  0   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17
  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32  33  34  35
  36  37  38  39  40  41  42  43  44  45  46  47  48  49  50  51  52  53
  54  55  56  57  58  59  60  61  62  63  64  65  66  67  68  69  70  71
  72  73  74  75  76  77  78  79  80  81  82  83  84  85  86  87  88  89
  90  91  92  93  94  95  96  97  98  99 100 101 102 103 104 105 106 107
 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125
 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143
 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161
 163 164 165 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181
 182 183 184 185 186 187 188 189 190 191 192 194 195 196 198 199 200 201
 202 203 205 206 207 208 209 210 211 213 214 215 216 217 219 220 221 223
 224 225 226 227 228 229 231 232 233 234 235 236 237 238 239 240 241 242
 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260
 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278
 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296
 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314
 315 316 317 318 319 320 321 322 323 324] not symmetrized, norm = [0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.50000001 0.5        0.5        0.5
 0.5        0.50000001 0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5        0.5        0.5
 0.5        0.5        0.5        0.5       ]


WARN: orbitals [ 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23
 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47
 48 49 50 51 52 53 54 55] not symmetrized, norm = [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5]

